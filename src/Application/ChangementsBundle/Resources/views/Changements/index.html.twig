{% extends "ApplicationChangementsBundle::layout.html.twig" %}
{% macro icon_class( type ) %}
  {% set type_class_map = {
    like: 'icon-user'
  } %}
  {{ type_class_map[type] }}
{% endmacro %}


{% block javascripts %}
{{ parent() }}
<script type="text/javascript" src="{{ asset('js/jquery.cookie.js') }}"></script>
   
<script type="text/javascript">
          
$(document).ready(function() {
 var mesdates=["#changements_filter_dateDebut","#changements_filter_dateFin"];
 mesdates.forEach(function(entry) {
   /* console.log(entry);*/
$( entry + "_left_date").datepicker({
minDate: "-1Y",
maxDate: "+10Y",
changeMonth: true,
changeYear: true,
numberOfMonths: 1,
dateFormat: "yy-mm-dd",
onClose: function( selectedDate ) {
$( "#form_bis" ).datepicker( "option", "minDate", selectedDate );
}
});  
$( entry + "_right_date").datepicker({
maxDate: "+10Y",
minDate: "-1Y",
changeMonth: true,
changeYear: true,
numberOfMonths: 1,
dateFormat: "yy-mm-dd",
onClose: function( selectedDate ) {
$( "#form_bis" ).datepicker( "option", "minDate", selectedDate );
}
})  
   
   
});

function runEffect() {
// get effect type from
var selectedEffect = 'slide';
//var selectedEffect = $( "#effectTypes" ).val();
// most effect types need no options passed by default
var options = {};
// run the effect
$( "#effect" ).toggle( selectedEffect, options, 800 );
};
// set effect from select menu value
$( "#button" ).click(function() {
runEffect();
return false;
});
//$( "#effect" ).hide();

 var ShowHideBox = $('#ShowHideBox');
 //var  ShowHideButton = $('#ShowHideButton');
initBox();
//ShowHideBox.hide();
//var ShowHideBox = $('#ShowHideBox').hide();

    $('#ShowHideButton').click(function() {
      if (boxVisible())
        {
             console.log("hidebox? box=1 status status="+boxVisible());
             hideBox();
        }
        else
        {
             console.log("box=1 status status="+boxVisible());
            showBox();
        }
    });

    function initBox()
    {
        
      /*  console.log("initbox: box=1 status status="+boxVisible());*/
        if ( $.cookie('Boxchangement')==1)
   {
        if (!boxVisible()){
      /* console.log("initbox box=1 doit montrer la box");*/
            showBox();
        }
        }
        else if ( $.cookie('Boxchangement')==0)
         {
            /*  console.log("initbox box=0 doit pas montrer la box");*/
             if (boxVisible()){
             
             hideBox();
             }
        }
    }  

    function boxVisible()
    {
         return ShowHideBox.hasClass('hidden')? false : true;
    }
  function showBox()
    {
     ShowHideBox.show().removeClass('hidden');
      $.cookie('Boxchangement', 1, {expires: 365});
       
    }
  function hideBox()
    {
      var options = {};
       ShowHideBox.hide().addClass('hidden');
  $.cookie('Boxchangement', 0, {expires: 365});
    }

}); //Eof:: ready
    </script>

{% endblock %}

    
  {% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="{{ asset('bundles/applicationchangements/css/sliding.css') }}" type="text/css" media="all"/>
 <style>
      tr.single {
         background-color: #000000;
        } 
        .free-day {
  background: #2e9500;
}
 
.free-day a {
  opacity: 0.7;
}
        div.ui-datepicker {
            font-size: 90%;
        }


tr.single {
         background-color: #f1f1f1;
        } 
        
#ShowHideContainer {
padding-top:10px;}
        </style>
 {% endblock %}

{% block content_header '' %}

{% block title %}
Changements
{% endblock %}


{% block content %}

{#{{ knp_menu_render('ApplicationChangementsBundle:MenuBuilder:mainMenu', {'currentClass': 'active'}) }}
#}
{#
{{ knp_menu_render('ApplicationChangementsBundle:MenuBuilder:mainMenu', { 'template': 'ApplicationChangementsBundle:Menu:knp_menu.html.twig' }) }}
#}

{% for type, flashMessages in app.session.flashbag.all() %}
    {% for flashMessage in flashMessages %}
<div class="alert alert-{{ type }}">
          
    <button type="button" class="close" data-dismiss="alert">&times;</button>
      {{ flashMessage|trans }}
    </div>
 
    {% endfor %}
{% endfor %}
{#  <div id="datepicker"></div>#}
 {#{% if is_granted("ROLE_USER") %}#}

{#<h3>test</h3>#}
<a href="{{ path('changements_newflowstart') }}" class="btn btn-medium btn-primary"><i class="icon-plus"></i> Ajouter un Changement</a>
{#{% endif %}#}

 <div id="ShowHideContainer">
    <p><a id="ShowHideButton">
         <img src="{{ asset('images/eyes.png') }}" alt="SHOWHIDE"  width="20" height="20" />
        </a></p>
    <div id="ShowHideBox" class="hidden">
        {% include 'ApplicationChangementsBundle:Changements:indexsearch_form.html.twig' %}
        </div>
</div>
         <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr class="title">
                            <th>{{ knp_pagination_sortable(pagination, 'Id', 'a.id') }}</th>
                            <th{% if pagination.isSorted('a.nom') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Nom', 'a.nom') }}
                              <i class="icon-pencil"></i></th>
                            <th{% if pagination.isSorted('a.dateDebut') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date Debut', 'a.dateDebut') }}
                              <i class="icon-time"></i></th>
                            <th{% if pagination.isSorted('a.dateFin') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date Fin', 'a.dateFin') }}
  <i class="icon-time"></i></th>

                            <!--     <th{#% if pagination.isSorted('a.dateComep') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date COMEP', 'a.dateComep') }}</th>
                <th{% if pagination.isSorted('a.dateVsr') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date VSR', 'a.dateVsr') }#}</th>
                            --> 

<!--     <th{#% if pagination.isSorted('a.description') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Description', 'a.description') }#}</th>-->
                            <th{% if pagination.isSorted('b.nomprojet') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Projet', 'b.nomprojet') }}</th>
                            <th{% if pagination.isSorted('c.nomUser') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'D', 'c.nomUser') }}
                             <i class="icon-user"></i></th>
                            <th><i class="icon-book"></i></th>
                             <th><i class="icon-pencil"></i></th>
                            <th{% if pagination.isSorted('e.nomUser') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Users', 'e.nomUser') }}
                             <i class="icon-user"></i><i class="icon-user"></i></th>
                            <th{% if pagination.isSorted('d.idStatus.nom') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'F', 'd.idStatus.nom') }}
                             <i class="icon-flag"></i></th>
                      
                            {#
      <th>{{ knp_pagination_sortable(pagination, 'kind', 'k.type') }}</th>
<th class="{{ bootstrap.icon_class(heading) }}">{{ heading }}</th>#}
                              <th{% if pagination.isSorted('a.ticketExt') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'T_Ext', 'a.ticketExt') }}
                              <i class="icon-tag"></i></th>
                         
                                  <th{% if pagination.isSorted('a.ticketInt') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'T_Int', 'a.ticketInt') }}
                              <i class="icon-tag"></i></th>
                          <th{% if pagination.isSorted('g.nom') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Env', 'g.nom') }}
                          
                            <i class="icon-wrench"></i></th>
                            <!--<th>Avatar</th>-->
                            <th colspan="3">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
    {% for entity in pagination %}
                            
                        
                              
                             {% if entity.dateDebut %}
                             {% if date(entity.dateDebut) > date('-7days')  and date(entity.dateDebut) < date('+15days')%}
              <tr class="warning">
                           {% endif %}   {% else %} <tr>{% endif %}   
                                <td>{{ entity.id }}</td>
                                <td><a href="{{ path('changements_show', { 'id': entity.id }) }}">{{ entity.nom }}</a></td>
                                <td>{% if entity.dateDebut %}{{ entity.dateDebut|date('Y-m-d H') ~ 'h' }}{% endif %}</td>
                                <td>{% if entity.dateFin %}{{ entity.dateFin|date('Y-m-d') }}{% endif %}</td>
                                <!--<td>
                    {#% if entity.dateComep is not null %}
               {{ entity.dateComep|date('Y-m-d') }}
                    {% else %}
                            ----
            {% endif %#}
                                    </td>
                                    <td>
                        {#% if entity.dateVsr is not null %}
               {{ entity.dateVsr|date('Y-m-d') }}
                    {% else %}
                                ----
            {% endif %#}
                                        </td>-->



                            <!--<td>{#{ entity.description|raw }#}</td>-->
                                <td>{{ entity.idProjet.nomprojet }}</td>
                                <td>{{ entity.demandeur.nomUser }}</td>
                                <td>{{ entity.picture|length }}</td>
                                <td>{{ entity.comments|length }}</td>
                                <td>
                 {{ entity.idusers|join(', ') }}   
               {#% for user in entity.idusers %} {{ user.nomUser }}

       {% endfor %#}
                                    </td>
                                    <td>
                               {% if entity.idStatus.description == 'open' %}

                                            <img src="{{ asset('bundles/applicationcertificats/images/cadenas-souvert.png') }}" alt="show" width="15" height="15" />

 {% else %}

                                            <img src="{{ asset('bundles/applicationcertificats/images/cadenas-sferme.png') }}" alt="show" width="15" height="15" />
        {% endif %}   </td> 
                                     
                                        <td> {{ entity.ticketExt }}   </td>
                                        <td> {{ entity.ticketInt }}   </td>
                                    <td>
                                    {{ entity.idEnvironnement|join(', ') }}   

                 {#{ entity.idEnvironnement|join(', ') }}   
               {% for envi in entity.idEnvironnement %} {{ envi.nom }}
       {% endfor %#}
                                            </td>

                                            <!--                                        <td>-->

{#% if entity.avatar %}{{ entity.avatar }}{% endif %#}<!--</td>-->

                                            <td>
                                                <a href="{{ path('changements_show', { 'id': entity.id }) }}">
                                                    <img src="{{ asset('bundles/applicationcertificats/images/detail.png') }}" alt="show" width="15" height="15" />
                                                </a>
                                            </td>
                                          

{% if is_granted("ROLE_USER") %}
                                              <td>
                                                <a href="{{ path('changements_edit', { 'id': entity.id }) }}">
                                                    <img src="{{ asset('bundles/applicationcertificats/images/edit.png') }}" alt="edit" width="15" height="15" />
                                                </a>
                                            </td>
                                            {% endif %}
                                            
                                            <td>


                                                <a href="{{ path('changements_comment_show', { 'id': entity.id }) }}">
                                                  <i class="icon-pencil"></i>
                                                </a>
                                            </td>
                                             

                                        </tr>
    {% endfor %}
                                    </tbody>
                                </table>

   {{ knp_pagination_render(pagination, 'ApplicationChangementsBundle:pagination:twitter_bootstrap_pagination.html.twig') }}

 
 
{% endblock %}
