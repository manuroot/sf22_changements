{% extends "ApplicationChangementsBundle::layout.html.twig" %}
{% form_theme search_form with 'ApplicationChangementsBundle:Form:tpl_searchform.html.twig' %}


{% macro icon_class( type ) %}
  {% set type_class_map = {
    like: 'icon-user'
  } %}
  {{ type_class_map[type] }}
{% endmacro %}

{% block javascripts %}
    {{ parent() }}
<script type="text/javascript" src="{{ asset('js/compiled/changementsown.js') }}"></script>
{% if is_granted("IS_AUTHENTICATED_FULLY") %}
<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
<script type="text/javascript" src="{{ asset('bundles/applicationchangements/js/changementsicons.js') }}"></script>
<script>
    $(function() {
         if ( $.cookie('Boxchangementown')==1){
    $(document).scrollTop( $("#matable").offset().top -100 );  
         }
});
 </script>
{% endif %}
  {{ form_javascript(search_form) }}
{% endblock %}


  {% block stylesheets %}
{{ parent() }}
 <link rel="stylesheet" href="{{ asset('bundles/applicationchangements/css/ccpchangements.css') }}" type="text/css" media="all"/>
 <style>

        th.sorted{color: rgb(0, 136, 204);
    text-decoration: none;}
.ui-autocomplete { max-height: 200px; overflow-y: scroll; overflow-x: hidden;}
            .table {
                font-size: 11px;
                /* border-collapse: separate;*/
                /*  font-family: 'Times New Roman',Times,serif;*/
            }
            select option:hover {
                background-color: #b6d1fd;
}
            select#changements_searchfilter_idusers{
            height:150px;}
            label,.mondiv { color:#02195e; font-size: 12px;
    font-weight: normal;
    line-height: 20px;}
            
 div#mybutton {

	padding-top: 130px; 
	margin-left: 5px;
       }
       div.pagerfanta nav{ margin:auto;width:auto;}
     
        </style>
           {{ form_stylesheet(search_form) }}
{% endblock %}

{% block content_header '' %}

{% block title %}
        PLANNING DES OPERATIONS  
{% endblock %}

{% block content %}

{% set dateright = '30' %}
{% set date_right_warning= '+' ~  dateright ~ 'days' %}
{#{% set date_right_warning= '+15days' %}#}

{% include 'ApplicationChangementsBundle:templates:flash.html.twig' %}
        
    
{% include 'ApplicationChangementsBundle:templates:container_search.html.twig' 
        with {
            'form_path': 'changements_posttestdebugfanta',
            'search_form': search_form,'box':"ShowHideBoxown",
             'new_path': 'changements_newflowstart',
            'new_text':"Ajouter une Opération",
              'include_html_search':  'ApplicationChangementsBundle:Changements:indexsearchsimple_form.html.twig'
}
%}

 
{#{% set mabar = {'foo': 'bar'} %}#}
{% set itemsa = { 'a.id': ['50px','icon-time','ID'],'a.nom':['150px','icon-user','User'],
'a.dateDebut': ['80px','icon-time','Debut'],'a.dateFin': ['80px','icon-time','Fin'],
'b.nomprojet': ['100px','icon-tag','Projet'],'a.demandeur': ['30px','icon-user','D'],
 } %}
        
{% set itemsb = { 'e.nomUser': ['100px','icon-user','Users'],'d.idStatus.nom':['30px','icon-flag','F'],
'a.ticketExt': ['100px','icon-tag','T_Ext'],'a.ticketInt': ['50px','icon-tag',' T_Int'],
'g.nom': ['80px','icon-tag','Env'],
 } %}      

                         
                                      
                                             
       {#            
         {% for key, value in items %}
        {{ key }}
         
              <li>xxx: {{ value[0] }}</li>
              <li>xxx: {{ value[1] }}</li>
           
    {% endfor %}
              #}
        <div id="matable">
     <table class="table table-striped table-bordered table-hover">
  <thead>
   <tr class="title">
       <script>var menuDownUrl = "{{ asset('bundles/applicationcertificats/images/') }}";</script>
    
         
       
         {% for key, value in itemsa %}
       
         <th style="min-width:{{ value[0] }}"  class="sorted">
            <a href="{{ path('changements_posttestdebugfanta', {'sort':key,'dir':next_dir}) }}">
            {{ value[2] }} </a> <i class=" {{ value[1] }}"></i>
            {% if arrow[key] is defined %}
            <i class={{ arrow[key] }}></i>
            {% endif %}
         </th>
        {% endfor %}
      
                         {#   <th style="min-width:30px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.id','dir':next_dir}) }}">
                            ID </a> <i class=" icon-time"></i>
                             {% if arrow['a.id'] is defined %}
                                     <i class={{ arrow['a.id'] }}></i>
                                     {% endif %}
                            </th>
                            
                            <th style="min-width:150px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.nom','dir':next_dir}) }}">
                            Nom </a><i class=" icon-time"></i> 
                            {% if arrow['a.nom'] is defined %}
                            <i class={{ arrow['a.nom'] }}></i>
                                  {% endif %}
                                </th>
                                #}
                                      
                          {#           
                            <th style="min-width:80px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.dateDebut','dir':next_dir}) }}">
                            Debut </a><i class=" icon-time"></i>
                                 {% if arrow['a.dateDebut'] is defined %}
                            <i class={{ arrow['a.dateDebut'] }}></i>
                                  {% endif %}
                                </th>
                           
                            <th style="min-width:80px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.dateFin','dir':next_dir}) }}">
                            Fin </a><i class=" icon-time"></i>
                                 {% if arrow['a.dateFin'] is defined %}
                            <i class={{ arrow['a.dateFin'] }}></i>
                                  {% endif %}
                                </th>
                         #}
                  {#              
                       <th style="min-width:100px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'b.nomprojet','dir':next_dir}) }}">
                            Projet </a><i class=" icon-time"></i>
                            {% if arrow['b.nomprojet'] is defined %}
                            <i class={{ arrow['b.nomprojet'] }}></i>
                                  {% endif %}</th>
                       
                           
                             <th  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.demandeur','dir':next_dir}) }}">
                            D </a><i class=" icon-user"></i>
                                  {% if arrow['a.demandeur'] is defined %}
                            <i class={{ arrow['a.demandeur'] }}></i>
                                  {% endif %}</th>
                       
                    #}
                           
                              <th class="sorted">      <i class=" icon-book"></i></th>
                               <th class="sorted">     <i class=" icon-pencil"></i></th>
                               
                                    {% for key, value in itemsb %}
       
         <th style="min-width:{{ value[0] }}"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':key,'dir':next_dir}) }}">
                            {{ value[2] }} </a> <i class=" {{ value[1] }}"></i>
                             {% if arrow[key] is defined %}
                                     <i class={{ arrow[key] }}></i>
                                     {% endif %}
                            </th>
                             {% endfor %}
                      {#         
                       <th style="min-width:100px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'e.nomUser','dir':next_dir}) }}">
                            Users </a><i class=" icon-user"></i>  
                        {% if arrow['e.nomUser'] is defined %}
                            <i class={{ arrow['e.nomUser'] }}></i>
                                  {% endif %}</th>
                           
                           
                                  <th style="min-width:30px"class="sorted">
                                      <a href="{{ path('changements_posttestdebugfanta', {'sort':'d.idStatus.nom','dir':next_dir}) }}">
                                      F</a>
                                <i class=" icon-flag"></i>
                                      {% if arrow['d.idStatus.nom'] is defined %}
                            <i class={{ arrow['d.idStatus.nom'] }}></i>
                                  {% endif %}</th>
                        
                          
                           
                            <th style="min-width:100px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.ticketExt','dir':next_dir}) }}">
                            T_Ext </a><i class=" icon-tag"></i>
                                 {% if arrow['a.ticketExt'] is defined %}
                            <i class={{ arrow['a.ticketExt'] }}></i>
                                  {% endif %}</th>
                                
                                
                                             
                                  <th style="min-width:50px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'a.ticketInt','dir':next_dir}) }}">
                            T_Int </a><i class=" icon-tag"></i>
                             {% if arrow['a.ticketInt'] is defined %}
                            <i class={{ arrow['a.ticketInt'] }}></i>
                                  {% endif %}</th>
                                      
                                             
                                 
                              <th style="min-width:80px"  class="sorted">
                            <a href="{{ path('changements_posttestdebugfanta', {'sort':'g.nom','dir':next_dir}) }}">
                            Env </a><i class=" icon-time"></i>
                                   {% if arrow['g.nom'] is defined %}
                            <i class={{ arrow['g.nom'] }}></i>
                                  {% endif %}</th>
                     #}
                            {#
                            <th style="min-width:100px" {% if pagination.isSorted('e.nomUser') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Users', 'e.nomUser') }}
                                <i class=" icon-user"></i><i class=" icon-user"></i></th>#}
                           
                            <th colspan="4">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
    {% for entity in  pagerfanta.currentPageResults %}
                                 {% if entity.idStatus.description == 'closed' %} 
                            {# <tr class="closed">#}
                            <tr class="myclosed">
                                 {# sinon: open prepare ou wait #}
                            {% else %}
                                   {% if entity.idStatus.description == 'prepare' or  entity.idStatus.description == 'wait'%} 
                                     <tr class="prepare">
                                         {# encours==open#}
                                       {% else %}
                                             <tr class="success">
                                     {% endif %}
                              {% endif %}
                      
                           <td>{{ entity.id }}</td>
                            <td><a href="{{ path('changements_show', { 'id': entity.id }) }}">{{ entity.nom }}</a></td>
                              {#<td>{% if entity.dateDebut %}{{ entity.dateDebut|date('Y-m-d H') ~ 'h' }}{% endif %}</td>#}
                              <td>{{ entity.dateDebut|date('Y-m-d') }}</td>
                            <td>{{ entity.dateFin|date('Y-m-d') }}</td>
                            <td>{{ entity.idProjet.nomprojet }}</td>
                            <td>{{ entity.demandeur.nomUser }}</td>
                            <td>{{ entity.picture|length }}</td>
                            <td>{{ entity.comments|length }}</td>
                            <td>
                                  {{ entity.idusers|join(', ') }}   
                            </td>
                            <td>
                                {% if entity.idStatus.description == 'open' %}
                                    <a class="open" data-id="{{entity.id}}"  href="#{{ entity.id }}">
                                        <img src="{{ asset('bundles/applicationchangements/images/cadenas-souvert.png') }}" alt="show" width="15" height="15"/>
                                    </a>
                                {% elseif   entity.idStatus.description == 'closed' %}
                                    <a class="closed" data-id="{{entity.id}}"  href="#{{ entity.id }}">
                                        <img src="{{ asset('bundles/applicationchangements/images/cadenas-sferme.png') }}" alt="show" width="15" height="15" />
                                    </a>
                               {% else %}
                                    <a class="open" data-id="{{entity.id}}"  href="#{{ entity.id }}">
                                        <img src="{{ asset('bundles/applicationchangements/images/cadenas-sbleu.png') }}" alt="show" width="15" height="15" />
                                    </a>
                               {% endif %}
                            </td> 
                            <td> {{ entity.ticketExt }}   </td>
                            <td> {{ entity.ticketInt }}   </td>
                            
                            
                            <td>
                                {% for envir in entity.idEnvironnement %}
                                    {{ envir }} <br>
                                    {% endfor %}
                                </td>
                            <td>
                                <a class="editme" title="Opération: {{ entity.nom }}" href="{{ path('changements_showXhtml', { 'id': entity.id }) }}">
                                    <img src="{{ asset('bundles/applicationchangements/images/detail.png') }}" alt="show" width="15" height="15" />
                                </a>
                            </td>
                            
                        {% if is_granted("ROLE_USER") %}
                               <td><a href="{{ path('changements_edit', { 'id': entity.id }) }}">
                                <img src="{{ asset('bundles/applicationchangements/images/edit.png') }}" alt="edit" width="15" height="15" />
                                </a>
                            </td>
                            
                        {% endif %}
                            
                        <td>
                            <a href="{{ path('changements_comment_show', { 'id': entity.id }) }}">
                                <i class="icon-pencil"></i>
                            </a>
                        </td>
                </tr>
    {% endfor %}
 </tbody>
 </table>    
                </div>
         <div class="pagination" align="center">
                        {#<div class="pagerfanta">#}
{#{{ pagerfanta(pagerfanta, 'default') }}#}
  {{ pagerfanta(pagerfanta, 'twitter_bootstrap') }}
          </div>

      

<br>
{% endblock %}