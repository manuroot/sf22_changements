{% extends "ApplicationChangementsBundle::layout.html.twig" %}
{% macro icon_class( type ) %}
  {% set type_class_map = {
    like: 'icon-user'
  } %}
  {{ type_class_map[type] }}
{% endmacro %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts 
    '@ApplicationChangementsBundle/Resources/public/js/jquery.cookie.js'
    '@ApplicationChangementsBundle/Resources/public/js/changements.js'
      output='js/compiled/changements.js' filter='?yui_js' %}
<script src="{{ asset_url }}"></script>
{% endjavascripts %}
   {# <script type="text/javascript" src="{{ asset('bundles/applicationchangements/js/js/jquery.cookie.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/applicationchangements/js/changements.js') }}"></script>
#}
{% endblock %}

    
  {% block stylesheets %}
{{ parent() }}
     {% stylesheets 
                '@ApplicationChangementsBundle/Resources/public/css/sliding.css' 
                '@ApplicationChangementsBundle/Resources/public/css/changements.css' 
                output='css/compiled/changements.css' filter='cssrewrite,?yui_css' debug=false %}
<link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}" />
{% endstylesheets %}
{#<link rel="stylesheet" href="{{ asset('bundles/applicationchangements/css/sliding.css') }}" type="text/css" media="all"/>
<link rel="stylesheet" href="{{ asset('bundles/applicationchangements/css/changements.css') }}" type="text/css" media="all" /> 
#}

<style>
        td {
    font-size: 12px;
    /*border-collapse: separate;*/
   /* font-family: 'Times New Roman',Times,serif;*/
}
      .input-append, .input-prepend {
  
    font-size: 0px;
    white-space: nowrap;
  padding-left:3px;
    float:left;
}
/*
.table-bordered {
    border-width: 1px 2px 2px 1px;
    border-style:solid solid solid solid;
    border-color: silver -moz-use-text-color;
    -moz-border-top-colors: none;
    -moz-border-right-colors: none;
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    border-image: none;
    border-collapse: separate;
    border-radius: 4px 4px 4px 4px;
}*/
/*
tr.success {
background-color: #999999}
*/

    </style>
{% endblock %}

{% block content_header '' %}

{% block title %}
PLANNING DES OPERATIONS
{% endblock %}

{% block content %}

{% set dateright = '30' %}
{% set date_right_warning= '+' ~  dateright ~ 'days' %}
{#{% set date_right_warning= '+15days' %}#}
{% for type, flashMessages in app.session.flashbag.all() %}
    {% for flashMessage in flashMessages %}
<div class="alert alert-{{ type }}">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
      {{ flashMessage|trans }}
    </div>
 
    {% endfor %}
{% endfor %}


 <div id="ShowHideContainer">
  
<form id="target" class="form-horizontal" action="{{ path('changements_post') }}" method="POST" {{ form_enctype(search_form) }}>
    <a id="ShowHideButton">
        <button id="show" type="submit" name="submit-filter" class="btn btn-medium btn-warning" value="show" >
            <i class="icon-search"></i>  Afficher Filtres</button>
    </a>
    <button type="submit" id="reset" name="submit-filter" class="btn btn-medium btn-warning" value="reset" >
        <i class="icon-minus-sign"></i> Effacer Filtres</button>
            <a href="{{ path('changements_newflowstart') }}" class=" ajoutchange btn btn-medium btn-primary">
                <i class="icon-plus"></i> Ajouter un Changement
            </a>
</form>

<div id="ShowHideBox" class="hidden">
        {% include 'ApplicationChangementsBundle:Changements:indexsearchpost_form.html.twig' %}
        </div>
</div>
        <table class="table table-bordered table-hover">
                    <thead>
                        <tr class="title">
                            <th>{{ knp_pagination_sortable(pagination, 'Id', 'a.id') }}</th>
                            <th{% if pagination.isSorted('a.nom') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Nom', 'a.nom') }}
                              <i class="icon-pencil"></i></th>
                            <th{% if pagination.isSorted('a.dateDebut') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date Debut', 'a.dateDebut') }}
                                <i class="icon-time"></i></th>
                            <th{% if pagination.isSorted('a.dateFin') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date Fin', 'a.dateFin') }}
                                <i class="icon-time"></i></th>
                            <th{% if pagination.isSorted('b.nomprojet') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Projet', 'b.nomprojet') }}</th>
                            <th{% if pagination.isSorted('c.nomUser') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'D', 'c.nomUser') }}
                                <i class="icon-user"></i></th>
                            <th><i class="icon-book"></i></th>
                            <th><i class="icon-pencil"></i></th>
                            <th{% if pagination.isSorted('e.nomUser') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Users', 'e.nomUser') }}
                                <i class="icon-user"></i><i class="icon-user"></i></th>
                            <th{% if pagination.isSorted('d.idStatus.nom') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'F', 'd.idStatus.nom') }}
                                <i class="icon-flag"></i></th>
                             <th{% if pagination.isSorted('a.ticketExt') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'T_Ext', 'a.ticketExt') }}
                                <i class="icon-tag"></i></th>
                             <th{% if pagination.isSorted('a.ticketInt') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'T_Int', 'a.ticketInt') }}
                                 <i class="icon-tag"></i></th>
                            <th{% if pagination.isSorted('g.nom') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Env', 'g.nom') }}
                                <i class="icon-wrench"></i></th>
                            <th colspan="3">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
    {% for entity in pagination %}
                     {# si datedebut existe #}   
          {#   {% if entity.dateDebut %}#}
                            
                            {% if entity.idStatus.description == 'closed' %} 
                             <tr class="closed">
                                 {# sinon: open prepare ou wait #}
                            {% else %}
                                   {% if entity.idStatus.description == 'prepare' or  entity.idStatus.description == 'wait'%} 
                                     <tr class="warning">
                                         {# encours==open#}
                                       {% else %}
                                             <tr class="success">
                                     {% endif %}
                              {% endif %}
                                                     
                            {# Pas commencé mais approche #}
             {#   {% if date(entity.dateDebut) > date() and date(entity.dateDebut) < date(date_right_warning) %}
                        <tr class="error">#}
                            {# operation terminée avec succes #}
                {#{% elseif date(entity.dateFin) < date() and entity.idStatus.description == 'closed' %} #}
                   
         {#    {% endif %}   #}
                                
                            <td>{{ entity.id }}</td>
                            <td><a href="{{ path('changements_show', { 'id': entity.id }) }}">{{ entity.nom }}</a></td>
                            <td>{% if entity.dateDebut %}{{ entity.dateDebut|date('Y-m-d H') ~ 'h' }}{% endif %}</td>
                            <td>{% if entity.dateFin %}{{ entity.dateFin|date('Y-m-d') }}{% endif %}</td>
                            <td>{{ entity.idProjet.nomprojet }}</td>
                            <td>{{ entity.demandeur.nomUser }}</td>
                            <td>{{ entity.picture|length }}</td>
                            <td>{{ entity.comments|length }}</td>
                            <td>
                                {{ entity.idusers|join(', ') }}   
                                {#% for user in entity.idusers %} {{ user.nomUser }}
                                {% endfor %#}
                            </td>
                            <td>
                                {% if entity.idStatus.description == 'open' %}
                                    <a class="open" data-id="{{entity.id}}" href="#">
                                        <img src="{{ asset('bundles/applicationcertificats/images/cadenas-souvert.png') }}" alt="show" width="15" height="15"/>
                                    </a>
                                {% elseif   entity.idStatus.description == 'closed' %}
                                    <a class="closed" data-id="{{entity.id}}" href="#">
                                        <img src="{{ asset('bundles/applicationcertificats/images/cadenas-sferme.png') }}" alt="show" width="15" height="15" />
                                    </a>
                               {% else %}
                                    <a class="open" data-id="{{entity.id}}" href="#">
                                        <img src="{{ asset('bundles/applicationcertificats/images/cadenas-sbleu.png') }}" alt="show" width="15" height="15" />
                                    </a>
                               {% endif %}
                            </td> 
                            <td> {{ entity.ticketExt }}   </td>
                            <td> {{ entity.ticketInt }}   </td>
                            <td>{{ entity.idEnvironnement|join(', ') }}</td>
                            <td>
                                <a href="{{ path('changements_show', { 'id': entity.id }) }}">
                                    <img src="{{ asset('bundles/applicationcertificats/images/detail.png') }}" alt="show" width="15" height="15" />
                                </a>
                            </td>
                            
                        {% if is_granted("ROLE_USER") %}
                               <td><a href="{{ path('changements_edit', { 'id': entity.id }) }}">
                                <img src="{{ asset('bundles/applicationcertificats/images/edit.png') }}" alt="edit" width="15" height="15" />
                                </a>
                            </td>
                        {% endif %}
                            
                        <td>
                            <a href="{{ path('changements_comment_show', { 'id': entity.id }) }}">
                                <i class="icon-pencil"></i>
                            </a>
                        </td>
                </tr>
    {% endfor %}
 </tbody>
 </table>

   {{ knp_pagination_render(pagination, 'ApplicationChangementsBundle:pagination:twitter_bootstrap_pagination.html.twig') }}

 
 
{% endblock %}
